// Generated by CoffeeScript 1.6.3
(function() {
  var controller;

  controller = function(scope, params, ParseCrud, timeout, http, location) {
    var Processes, id;
    id = params.id;
    scope.id = params.id;
    scope.text = '';
    scope.entity = {};
    scope.success = '';
    scope.error = '';
    scope.selected = 'document';
    Processes = new ParseCrud('Processes');
    Processes.getWith(params.id, ['wordslist', 'documents'], function(d) {
      return scope.$apply(function() {
        scope.entity = d;
        return scope.graph();
      });
    });
    scope.remove = function(entity) {
      return entity.destroy({
        success: function() {
          scope.success = 'Removed successfully.';
          scope.error = '';
          return location.path('/processes');
        },
        error: function(e) {
          console.log(e);
          scope.success = '';
          return scope.error = 'Error occurred while removing.';
        }
      });
    };
    return scope.graph = function() {
      var data, formatPercent, height, margin, svg, tip, width, x, xAxis, y, yAxis;
      margin = {
        top: 40,
        right: 20,
        bottom: 30,
        left: 40
      };
      width = 960 - margin.left - margin.right;
      height = 500 - margin.top - margin.bottom;
      formatPercent = d3.format(".0%");
      x = d3.scale.ordinal().rangeRoundBands([0, width], .1);
      y = d3.scale.linear().range([height, 0]);
      xAxis = d3.svg.axis().scale(x).orient("bottom");
      yAxis = d3.svg.axis().scale(y).orient("left").tickFormat(formatPercent);
      tip = d3.tip().attr("class", "d3-tip").offset([-10, 0]).html(function(d) {
        return "<strong>Frequency:</strong> <span style='color:red'>" + d.frequency + "</span>";
      });
      svg = d3.select("#chart").append("svg").attr("width", width + margin.left + margin.right).attr("height", height + margin.top + margin.bottom).append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");
      svg.call(tip);
      data = _.map(scope.entity.get('result'), function(d) {
        return {
          word: d[0],
          frequency: d[1] * 100
        };
      });
      x.domain(data.map(function(d) {
        return d.word;
      }));
      y.domain([
        0, d3.max(data, function(d) {
          return d.frequency;
        })
      ]);
      svg.append("g").attr("class", "x axis").attr("transform", "translate(0," + height + ")").call(xAxis);
      svg.append("g").attr("class", "y axis").call(yAxis).append("text").attr("transform", "rotate(-90)").attr("y", 6).attr("dy", ".71em").style("text-anchor", "end").text("Frequency");
      return svg.selectAll(".bar").data(data).enter().append("rect").attr("class", "bar").attr("x", function(d) {
        return x(d.word);
      }).attr("width", x.rangeBand()).attr("y", function(d) {
        return y(d.frequency);
      }).attr("height", function(d) {
        return height - y(d.frequency);
      }).on("mouseover", tip.show).on("mouseout", tip.hide);
    };
  };

  angular.module('wordsApp').controller('ProcessedDocumentCtrl', ['$scope', '$routeParams', 'ParseCrud', '$timeout', '$http', '$location', controller]);

}).call(this);

/*
//@ sourceMappingURL=document.map
*/
